OK, so I want to build a mostly client-side typescript website that is able to manage pickleball play sessions.
It should do the following:
* Support a king of the court mode
* Support a round-robin mode
-- The round-robin mode should try to maximize the number of different people you play with in the least amount of games.
* Support doubles sessions 
* Support Singles Sessions
* Support a teams session where players are locked together the entire time, and only their opponents change
* Support having an uneven number of players, and having people wait for games. -- It should be as fair as possible with choosing who waits so that people don't have to wait repeatedly
* Have a way to input a list of players for a session
* Support adding/removing players from a session dynamically
* Have a nice UI that shows where each player will play 
* Have a queue system that waits for an open court and then assigns players to the court when it's free
* Have a UI where users can input the score for a game when it is finished
* Support banning potential team pairs for people that don't want to play together
* 

The website should have a robust unit test suite for all the capabilites that are built.





### Revision 2
Great start! Some major changes are required. We need to be able to see a list of players, and dynamically add
   and remove players (some might come later, or leave the session early) -- we need to be able to forfeit a game --
   which will be like that combination of players played, but there will be no saved results. We also need to remove
   the "Start Next Round" capabilities, don't think of it as having rounds, think of it as a continuous queue of
   games, everytime scores are input, the global state is re-evaluated and more games are made as possible.
   
### Revision 3
 This is great, is there a way we can see a history of all games played easily? We should also be able to edit the
   scores of those historical games if there was a mistake. Also, for the courts being displayed, can we have Team 1 be
    boxed in the left, Team 2 being boxed on the right, and the controls & score input in the middle between them?
   Right now it's top to bottom which is a little weird.
   
### Revision 4

It's a little annoying entering a bunch of test player names everytime I want to try this out, can you give me a
   special button if I access the site with a query param like ?test=true , the special button adds 18 players with
   first and last names.
   
### Revision 5

This is great. Some improvements if you please:
* Everytime you complete a game on a court, all the court positions change, they should stay static, and always numbers logically in ascending order.
* We need to see the history of every game that was every played on each court, not just the last game on a court
* The team boxes aren't always rendering correctly in the Court box, they are overflowing -- can you fix that?

### Revision 6
* If I click End session, all the players are lost -- we need an Edit session button as well, that lets us keep the players that we already added, but just change the mode or court configuration that we're playing.

### Revision 7
* It's hard to see the numbers in the score boxes, make the score font smaller. 
* Scores like 5-5 are not valid, but I am allowed to submit them and it shows a winner/loser. A winner must have a score higher than the loser.
* If I add a player after the session started, that player never gets rotated in. They should actually be the first rotation in!

### Revision 8
* Scores in the history are hard to see, they should just be a text box, don't render the up-down arrow to increase/decrease.
* If I show history and finish a game, I need to hide & show history again for it to redraw -- fix it so that it auto redraws history.
* Make sure that history is chronological -- the game that most recently finished should be at the top.
* Make it so that history is shown by default. 

### Revision 9
* Please add a dark mode/light mode toggle, and make dark mode the default.

### Revision 10
* The text is a little hard to read -- black on very dark grey doesn't work. Use a more visible dark color scheme...
* Round robin mode is very deterministic -- We should be able to know exactly what games we have scheduled once we start a session --- and when we add a player, we should be able to recalculate all the future sessions immediately. Add a show queue button that shows the next scheduled games -- it should show the next 10 by default for round robin (and maybe even make it a paged area so a user can go forward or backwards by clicking arrow buttons). Make the number of games that it shows on page configurable, like the number of courts per row is configurable.
* For King of the court mode, we need to wait and see who wins and loses the current games before we can queue the next ones, so that logic needs to function differently. We don't want to queue a game as soon as one finishes, because we want this to function in more of a bracketed/rounds format.

### Revision 11
*The player tags that you can add or remove still have black text on dark backgrounds, that still needs to be updated with a more visible color scheme.
*The Match Queue currently renders above the Active Courts box, it should render below the Active Courts box.
* Inside of the Active Courts box, the score boxes still have the up/down arrows, we don't need that, they can just be text input boxes like in the Match History box.
* Matches per Page have the up/down arrows, we don't need those there either, just have it be a plain text input box.

### Revision 12
* The Active Courts box is now rendering below the match history and match queue elements. That's not good, Active Courts needs to be at the top, then Match Queue below it, then Match History below Match Queue, and Player Statistics all the way at the bottom...

### Revision 13
* When I click show Queue, the button doesn't change to "Hide Queue" -- it stays "Show Queue" -- make sure the toggle is working correctly, and the queue starts as visible
* When I click Edit Session, Match Queue stays visible on the Session Setup page, that shouldn't happen.
* Match queue is only showing 3 games for round robin -- it can technically show infinite sessions, so please calculate up to the max needed to fill the specified Matches per Page configuration (which is 10 by default). For this reason, Page x of x doesn't make sense, it should just show the current page number.
 
### Revision 14
* In the match queue, games number 1 & 6 have the same players, also 2 & 7 have the same players. The round robin queue system is clearly not calculating the queue correctly. 

### Revision 15
* When I click end session the match queue is visible on the session setup, but there is no longer an active session, so there shouldn't be any match queue!
* Instead of having the added players appear as floating tiles/buttons/elements, the added players should display as a numbered list (we still need to be able to remove them by pressing the red X next to their name)
* Player statistics needs to update automatically every time a game completes -- currently, it only updates when I hide and show statistics.

### Revision 15.5
* For the players list on the session setup page, please make sure each entry in the list has a visible number, EG 1. James Anderson
* If possible, please make the numbered list span multiple columns so it doesn't take so much space.
* The players list should display as a multi-column list on the Active Session page the same way that it shows up in the Session Setup Page

### Revision 15.6
* Not quite there yet, There are no visible numbers next to the play names. I just see names like "James Anderson" or "Sarah Mitchell", but it should be a numbered list, EG "1. James Anderson" "2. Sarah Mitchell". 
* Also, it's all just one long list, I need it to span multiple columns, lets do 3 columns.

### Revision 15.7
* It is now multi-column, but it still doesn't have numbers displayed next to the name yet. Also, the 3 columns only
   take up like half the page, it should auto fill the space it has -- if possible, maybe make it a variable number of
   columns depending on the width.
   
   
### Revision 16
* When I press start session, the Match Queue shows empty. It doesn't render until I click Next and then Previous.
* The columns are a little bit tough to distinguish, Please add some styling so that every other column has some sligthly different shading to differentiate them.

### Revision 17
* We calculate a ton of queued matches at the start, which makes loading a new session or adding a player pretty slow. Can we limit it so that we only calculate 100 matches in advance and then stop (make this 100 matches configurable in the UI). We should recalculate again once we add or remove a player or the number of matches in queue reaches 80% of the 100 configured number.

### Revision 17.1
* Perfect! The Max Queue Size configuration needs to be on the Session Setup page as well.

### Revision 17.2
* It's kind of an advanced / admin control. Can we have a separate "Advanced Config" subpage that we open by pressing a button on the Session Setup page? It should just be an icon that only pro users know to click.

### Revision 18
* The round robin algorithm doesn't seem like it maximizes the amount of different players people play with as soon as possible. Instead, players seem to play with the same other players with minimal variations. Please create a test suite and test cases for the round robin algorithm used so that we get as much variation as in as few games as possible. Make sure the function used in the test suite are the same functions used in the actual code.

### Revision 18.1
* I see this, 1st game court 1: Team1: "James Anderson" "Sarah Mitchell" Team 2: "Michael Chen" "Emily Rodrigues", Then 4th game in Queue is: Team 1: "James Anderson" "Michael Chen" Team 2: "Sarah Mitchell" "Emily Rodrigues"  --- There are 18 players in this session, there is no reason why These same 4 people should be playing again so soon, just with a little variation in the teams. Please improve the tests and algorithm to ensure more player diversity early on.

### Revision 18.2
* Ooof this is bad, in an 18 player game with 2 courts available, player #17 and #18 don't play until Game #21... Something is still seriously wrong with this algorithm. 


### Revision 19
* Please now build tests for the king of the court algorithm, make sure the algorithm attempts to have :
** Equal play time: Every player should get roughly the same number of games (no one sitting too long).
** Avoid long idle times: The algorithm should minimize players waiting multiple rounds in a row.
** Variety of opponents: Players should face as many different people as possible (not the same group repeatedly). -- but winning opponents should face winning opponents as much as possible.
** Partner diversity (for doubles): Try to maximize the variety of partners over the session.
** Promotion and demotion logic: Winners move up, losers move down (classic King of the Court format) -- there can be some leeway in this to achieve other algorithm goals.
** Graceful handling of uneven outcomes: If a player sits out or leaves, the algorithm should rebalance smoothly.
** Deterministic scheduling: Given the same results, it should produce the same next-round assignments.

### Revision 19.1
* Please tune and fix the king of the court algorithm...  If we need for matches to finish before we can determine the next
    round, make sure we add support for that logic.

### Revision 20
* When I start a King of the Court match, my courts just sit there "Waiting for Players..." Something isn't working right... Also, it says "Queue is only available for Round-Robin mode... But there should be a queue for king of the court, it's just not 100% predetermined.

### Revision 20.1
* After I input all the scores, I have to click "Start Next Round" --- Can we have it automatically start the next round when all the scores are inputted for that round?

### Revision 21
* Teams is considered a game mode, but really you can have Team Round Robin and Team King of the Court. Rework Team logic, make sure you can add 2 players as a team when doing Team Round Robin or Team King of the Court --- If algorithm reuse for round robin and king of the court is possible, we should try to implement that --- Also, verify all the existing tests work after this change.

### Revision 21.1
* This logic works, but it's clunky... Adding players then making them a team is tedious, When Locked Teams is selected, make it so that we add players as a team (IE Two inputs for players that will be together). -- With this way of working, we don't need players displayed and teams displayed in two different areas, we just need the teams displayed.

### Revision 21.2
* Give me a test function, like "Add 18 Test Players", but instead have it be "Add 9 Teams".

### Revision 22
* Add a current rankings button during a session that ranks all the players from best to worst... First rank players by total number of wins -- handle ties by giving a higher rank to the player with the better average point differential in all their games. 
* Make sure you also write tests for these ranking features.

### Revision 23
* For locked team sessions, make sure the Current Session page shows the locked teams rather than individual players -- The same as it is in the SEssion Setup Page
* For team sessions, A team gets 1st, 2nd, 3rd --- not the individual players -- make sure the ranking component updates to show the team together, not the player.

### Revision 24
* We don't want a player that gets added late to a game to essentially never wait because other people have played 2-3 games already, so it makes the most since that a player that gets added later should have their wait status = the max waited by the person that has waited the most so far + 1. Please implement that. (Also, wait times should apply to teams as a whole in team mode)
* When team mode is enabled, make sure you can dynamically add and remove teams in the active session page. 

### Revision 25
* Please update the favicon to be the tennis/pickleball icon so it shows that way in the browser address bar and window
* Please update the app so that the current state is saved locally in the browsers data -- If a user does a refresh or a hard-refresh, all the current data should stay. Please add a "Clear Current Session Configuration" in the Sessions Control page to be able to purge the local browser data cache for this site.

### Revision 26
* Make "Show Rankings" a Closable Pop-Up window, instead of an element on the page that we have to scroll down to see
* Change the default number of courts to 4 instead of 2

### Revision 26.1
* Also make "Show Statistics" a Closable Pop-Up window like "Show Rankings" is now.

### Revision 26.2
* Move "Show History" next to the "Show Queue" Button. The button Order should be: "Show Queue" "Show History" Show Rankings" "Show Statistics" "Edit Session" "Clear Session Data" "End Session".

### Revision 26.3
* Rename "Edit Session" to "Edit Session Config"

### Revision 27
* Courts elements in the Active Courts box can overflow the screen, and there is no way to scroll if that happens. Either make it scrollable, or make the elements autofit. 

### Revision 27.1
* The problem is when the courts overflow in the screen width, there is now left-right scroll bar. I have no problem with the vertical scrollability.

### Revision 28
* I want to release this as a github page so that anybody can go to the link and use it. Will that work? Or is there is server component that is required? If it works, what changes do I need?

### Revision 29
* Please build comprehensive UI tests that run in a local browser.

### Revision 29.1
* Go ahead and run the UI tests, and fixup any that are broken

### Revision 29.2
* How come all the tests passed, but running npx -y vite@latest didn't work? Should we add a test for basic dev startup?


### Revision 30
* 7 of the Playwright tests failed, are you able to run the tests yourself, get the error output, and fix them?

### Revision 30.1
* Can you write me a simple script that runs all the tests? (E2E, Round Robin, and King of the Court Tests)

### Revision 30.2
* 'npm run test:all' doesn't work, try it yourself and fix any issues with it: npm run test:all

### Revision 30.2
* Excellent, please run and fix all failing tests (including timing tests)

### Revision 30.3
* How do I run the king of the court tests? Also, there are lots of failures with  `npm test run`, fix them please. Especially make sure all the unit tests run and pass for the round-robin and king of the court algorithms.

### Revision 31
* I have now purchased the domain `BetterPickleballSessions.com` -- please make the necessary updates to support this domain. Also, do any necessary App title renaming for Better Pickleball Sessions. 
* Add a single-page-app type navigation bar at the top that allows users to change between session controls for setup, the current active session, a page explaining the different modes and configurations, and an about page. PLease create the missing pages.

### Revision 31.1
* Beautiful, but just a few tiny bugs, when you click start session, the "Active Session" button doesn't become highlighted, the "Setup" button stays highlighted.
** Also, you shouldn't be able to start a session if there is already an active session. 

### Revision 31.2
* When you switch between the tabs, the logic for Hide/Show Queue and Hide/Show history doesn't work properly, it's indicating that it's already being showed, but it's not until you hide and show it again for both the queue and history.
* Review the king of the court algorithm and the Modes & Config description page, does what's described there actually match the algorithm? I don't think the algorithm is about moving up (atleast it shouldn't be), it's about winners playing winners, the court number the game is played on is irrelevant. (atleast that's how it should be)

### Revision 32
* Currently the King of the Court algorithm uses a strict round-based system. All rounds must finish before a new game is scheduled. But that's not really necessary -- we can have more of a continuous flow. Once 2 games finish, or 1 game finishes and we have 2 people waiting, we can immediately schedule the next game because we know who the winners are. Update the king of the court algorithm to be more continuous and less strict round based. Also, make sure you run and fix any tests that rely on this.

### Revision 32.1
* I think you broke king of the court --- now the courts finish all the matches scheduled at the start, and no new matches are ever scheduled, every just shows as waiting to play in the match queue (they're not even properly showing in the "Waiting Players" queue)... Something is wrong.

### Revision 32.2
* Continuous flow works now, but the problem is that we never wait for other courts to finish -- we are always scheduling a game with available players. That means we are not getting enough variation in the games played -- and the same players constantly play each other. We need to keep the big picture when scheduling games, it's OK to wait for 2 courts to finish before scheduling games. This is tricky, please think hard about a good algorithm to achieve this behavior. People who have only won games should probably never play against people who have only lost games. 

### Revision 32.3
* We're still not there yet, if I test this by only finishing games on court 1 with 2 people waiting, and never finish games on court 2,3,4, court 1 will still continuously get populated with games --- causing a lack of match variety. We need to have a court wait for other courts to finish when the same players have played in games with each other more than other players have already.

### Revision 32.4
* I don't think shouldWaitForBetterMatchups is happening, if I test this by only finishing games on court 1 with noone waiting, court 1 is just constantly populated by the same players playing against each other!


### Revision 32.5
* The algorithm has winning players playing with losing players to keep the flow going, that shouldn't happen. We
   need to wait for other courts to finish, and let some player variety kick in!!!!!
* Rework the algorithm to use the current rankings system, people should only ever play games that are close to them in rankings (if there are 18 players, there should only be 9 players that someone can ever play a game with -- IE 50% of the player pool) -- The #1 ranked player should only ever be able to play games with up to the #9 ranked player in an 18 player game. And the #18 ranked player should only ever be able to play games with up to the #10 ranked player. Have hard locks on this rule -- do not immediately schedule games if this condition is not met!!! Of course, we need special handling for players that haven't played any games at all. Add handling so that it prioritizes games with people closely ranked together -- especially if they haven't played together yet. EG, ideally, #16, #17, #18, #19 ranked players play together if possible. We need to also update the ranking so that somebody with a low win rate winning against someone with a low win rate/ranking doesn't push them to the top --- the value of a win needs to be based on some logarithmic function --- not just a straight wins-loss comparison. Please Think extra special about this algorithm, it's imperative that we get it right. Make sure we don't just rush to make games, its OK to wait for better games. 

### Revision 32.6
* Running the dev server fails with an HTML parse5 error, please fix: `npx -y vite@latest`

### Revision 32.7
* The hard lock on players only being able to play within 50% of the player pool by order of rankings is simply not working -- it's immediately scheduling a court after a game finishes regardless of ranking. Please fix!

### Revision 33
* Once we click Start Session, all session configuration options need to become un-editable until the current active session is ended. We should be able to end the current session from the Setup page (please add an "End Session" button there as well). 

### Revision 33.1
* You can still remove players for an active session on the Setup page, but nothing happens --- you shouldn't be able to remove players there when a session is active.
* Please have 2 buttons while a session is active: "End Session and Clear Data", "End Session and Keep Players"

### Revision 33.2
* When you remove a player from the Active Session page, it should also remove the same player from the Setup page, but that doesn't happen now. 

### Revision 34
* In the about page, Add a link to the github repository for this https://github.com/iysaleh/pickleball_session_manager . Mention that it's open source and to report issues, bugs or feature requests there.

### Revision 35
* Adding a player to an active session doesn't add the player to the Session Setup page --- it should. If you end a session but keep the players after adding a player, any players added after the initial setup should be present in the setup page.
* In King of the Court mode, There's an extra waiting players section within the Match Queue -- sometimes players correctly show up there, but not in the "Waiting Players" Area. There shouldn't be a second waiting players section within the Match Queue, "Waiting Players" should be updated with king of the court waiting players logic when another needs to finish before the next games can be scheduled.

### Revision 36
* For king of the court, We can still run into a situation where players that are similarly skilled can continually play games against or with each other... This is no fun. Put a hard cap at playing 1 game with the same players (on the same team) for every (total-players/4) games. We can wait for other courts to finish to get more games (assuming there are other courts). Put the same cap for the against each other portion. (or is there another solution you can think of to make this better?)

### Revision 36.1
* We have too many empty courts at any one time now, and it's possible to make it impossible to meet these new strict match conditions. We need to ease up the requirements.

### Revision 37
* Can we show and sort by the score that's actually being used in king of the court to arrange games in the "Show Rankings" page?

### Revision 38
* In show statistics, games played includes the current game that is not finished. That is not correct. It should only include completed games.

### Revision 39
* In King of the Court, I hate it where we have a game where players A B are against C D, and then the next game is with players A C vs D B ... Please add hard restrictions against back to back games with the same exact players.

### Revision 39.1
* Add a button to export the match history and current matches configuration in a simple text format (also include the current waiting players)

### Revision 39.2
* Look at this match history and current court setup @pickleball-session-11-03-2025-15-00.txt -- Player Ibraheem is against Leslie, even though she has lost every game, and he has won every game! That should never happen!!! Analyze what went wrong with the algorithm and fix it, and then add a manual test to avoid this from ever happening again.

### Revision 39.3
* Look at this match history and current court setup @pickleball-session-11-03-2025-15-05.txt --- Ibraheem is playing with players 14 and 2 again so soon, with just player 9 being new. That's not enough variety. Expand the back-to-back hard matchmaking limitation to prevent 3 of the same players from playing back-to-back as well.

### Revision 40
* Do all of these improvements to the king of the court algorithm also apply to locked teams mode, or do we need updates to support that?

### Revision 41
* Do the Rankings and Statistics been updated for teams so that we see team based information? Or is it still indvidual?

### Revision 41.1
*Look at the team session for @pickleball-session-11-03-2025-15-19.txt , At the start of the session, we had more than enough teams to make a match, but only 2 courts are filled!!! Something is seriously wrong. Fix it, and add a test so it doesn't happen again.

### Revision 42
* The site is no longer functional at https://betterpickleballsessions.com/

### Revision 43
* SEO Optimization

### Revision 44
* With 3 people waiting in the "Players Waiting" queue (IE 19 people in a 4 court setup), you can end up with cases with a small amount of player variety. Augment the king of the court algorithm to occassionally wait for 2 courts to finish even when it can technically schedule a game now, just to increase game matchup variety. Look at how often players 1 & 2 played against each other due to the lack of waiting in this session: @pickleball-session-11-04-2025-13-54.txt --- please minimize this effect.

### Revision 45
* When I click Start Session, the courts are populated in the order that players were added. Add an advanced configuration option that uses a random seed of the players instead. Disable it by default.

### Revision 46
* Please add the current game mode to the Active Session page after the Session Controls label, EG "Session Controls - King of the Court" or "Session Controls - Round Robin"

### Revision 47
* We need to augment both round robin and king of the court modes to keep track of which courts finish... If, for example, the same 2 courts finish twice before the other courts finish once, then we should wait until the other court finishes and then make a court. Every court needs to have an individual mix threshold counter. The waitlist should count as a court (the formula #waitlisted/4 should be used to determine how many courts the waitlist counts as, for example, if we have 8 players on the waitlist, that's 2 courts of diversity.) We need to slowly expand and decrease a variety counter. Keep track of which courts mixed with each courts last -- never mix with the same courts twice in a row, have them wait for another court to open, then mix all 3 courts (making the most balanced games possible).

### Revision 47.1
* Remember to treat the waitlist like a court, put a hard cap on the same courts mixing 2 times in a row.

### Revision TODO
* King of the Court doesn't really make sense for 4 players, but I tried it anyways. After 3 games, there were no more games to play and all 4 players just sat there waiting. Is something wrong with the algorithm? Shouldn't it never end, regardless of the configuration?
* Please add a test for 20 players and make sure the algorithm continues to work for 400 games, make the winners random...








* I want to make a new game mode called "Competetive Variety Matchmaking", we will build the algorithm for this piece by piece. Please build the shell for this new game mode, but since we don't have anything yet for it, it should just never make any courts when a new match is started.
* At the start of Competetive Variety Matchmaking, we just take up to the first numberOfEmptyCourts*4 available players from the waitlist and make those courts.

* The first feature I want to build for competetive variety matchmaking mode is a simple court variety algorithm... Consider each court as an entity, and the wait list as an entity. Courts may never make a game with the same four players that just played on the court (We assume the minimum players using competetive variety matchmaking is 10). After each match finishes, courts must mix with another court or the waitlist -- and we keep track of which courts just mixed with what court. For example, if court 1 finishes, all players must wait until another court (EG court 2) finishes. Then when another court finishes (or there are players in the wait list), 2 players are swapped from each court. If there is only 1 player on the waitlist, that court does not get made (there must be a minimum of 2 players in the waitlist for court mixing with the waitlist to happen). Consider the waitlist as multiple 4 unit groups that get tracked for this variety algorithm separately. EG, if there are 16 players and 2 courts, the waitlist will have 8 players (considered as 2 groups that mix separately for this variety algorithm). In 3+ court situations where there are enough players to fill them, we have a rule that courts may never mix with the same court (and waitlist) back to back. EG if courts 1 & 2 finish, and mix swapping players to fill themselves for the next game. If they finish again, they may not mix again, and players must return to the waitlist after the game finishes, and the court will be unoccupied until another court finishes. Once courts mix with a different court, we reset the court back to back tracking for all courts that had previously been blocked from being made. I'm sure there are some simple scenarios I forgot in writing this, but the overall idea to ensure match variety is there. Please build this feature, thinking comprehensively about what needs to be better for different scenarios.



* We want to build a variety component to competetive variety matchmaking. The first feature I want to build for competetive variety matchmaking mode is a simple variety algorithm... Keep track of each court that a player has last played on. The same 4 players may never make a game together on any court after having just played together. (We assume the minimum players using competetive variety matchmaking is 10). After each match finishes, players must mix with players that played on another court or that haven't played at all -- We must keep track of the courts that players just mixed together with. For example, if court 1 finishes, all players must wait until another court (EG court 2) finishes. Then when another court finishes (or there are players in the wait list), 2 players are swapped from each court. If there is only 1 player on the waitlist, that court does not get made (there must be a minimum of 2 players in the waitlist for mixing with the waitlist to happen). Prefer to mix with players that haven't played on any court yet before mixing with players that have previously played on a court. In 3+ full court situations (12+ players total), we have a rule that courts may never mix with players from the same court back to back. EG if courts 1 & 2 finish, and mix swapping players to fill themselves for the next game and then if they finish again, they may not mix again and the court will be unoccupied until another court finishes (EG court #3, #4, etc). I'm sure there are some simple scenarios I forgot in writing this, but the overall idea to ensure match variety is there. Please build this feature, thinking comprehensively about what needs to be better for different scenarios.



* In situations where we have 3+ active courts, after players from 2 courts mix once, we don't want them to mix again until atleast one other court has finished their session and are waiting.
--- Don't write any documentation


#### Python rework
* Do not write any documenation. writing documentation.
* This UI is atrocious, try to make it nice for the user. We want to draw the courts as rectangles on the active session page with the team members visibly shown on each side, the users in the waitlist need to be documented. When we complete a match, we don't need a success dialog, but we should have a confirm dialog.
* The round robin algorithm is not working right, we have the same player on multiple courts, that can't happen. A player can only be in one place at once -- either on a single court, or on the waitlist.


* The label text on the active session page is white text on a white background, make it white text on a black background so it's visible.
* All 4 courts are drawn with 1 court per row, displayed as a single column. Make it so courts are drawn 2 courts per row.




 > look at @KOC_RANKING_ALGORITHM.md , we want to develop an ELO like matchmaking system as described there for
   competetive variety in the python code @python\competitive_variety.py  -- we want hard caps on how frequently
   people play together -- if there are 12+ players, you should never play with the same person again until 2 games
   have elapsed since you played together. Similarly, you should not play against the same person again unless 1
   game has elapsed since you played together. Top ranked players should only play against the top 50% of players
   (the up/down range for all games made need to be 50% limited) -- of course, provisional players can play up and
   be the exception. Players are only provisional for 2 games.

* We are only working on the python code right now, not the javascript version of the app. Do not write any markdown documentation or summary files. Do not use EOF syntax to write temporary test files, instead just write the test file and run the test separately. Persist the tests. 
* Add a 'Make Court' button that lets you make a court with any of the players on the waitlist on any courts that are not currently occupied.(this should work in all Game Modes)
* Add an "Edit Court" capability that lets you double click a court to change the player orientation, or swap them out with any player on the waitlist. (this should work in all Game Modes)
* Make sure these new capabilities match our existing theme and do not have white text on white backgrounds anywhere. 
* The Competetive Variety and Round Robin algorithms should continue to work normally even if a court is manually made.
* The Export Session feature should export ELO and sort by it.



* When we end a session, keep the history of all the players added so that when New Session is Pressed again, all the players from the previous session are added automatically.
* Instead of "Load Session" for the main screen, have it be "New Session", "Resume Last Session", "New Session with Previous Players" (we are not persisting player rankings or stats for New Session with Previous Players, just the player names)
* When the app is closed or a session is ended, automatically save the session state locally in a file.... "Resume Last Session" should load that file and resume exactly where it left off.

### Revision 3


* Add an individual court timer for every court that starts ticking as soon as a court is made. Draw the court timer to the right of the Score Input boxes. Make sure that it follows the existing dark theme. Store the game duration in the match history. When we export the session results, we should have the duration for each match in the match history displayed. We should also calculate the average duration for all matches played.

* Add individual timers for each player that keeps track of how long they have been on the waitlist. Update the Show Statistics window to include how long each player has waited. Keep the "Waited" counter logic in tact, we are only adding timers here, not changing matchmaking behavior.

* If we have enough players to make a court waiting (4+), and an open court waiting for a match to be made, and all the other courts that have players have been playing for less than 5 minutes so far, make a court even if the existing matchmaking conditions aren't met. 

* I really like the Competetive Variety Matchmaking algorithm as it is now, build a collection of fuzzing tests to make sure that the algorithm behavior stays consistent going forward. The tests should run through about 100 matches aNd account for a variety of different player counts. The results of each iteration and session state should be verified after each match.

* On Windows 10, the main app background and general theme is light, but on Windows 11, everything is dark themed like I expect and want. Can we default to a dark theme for Windows 10 as well?

* We want to add some spacial aspect to the way courts are positioned. When we create a new session, add the ability to control a new feature called "Court Sliding" with possible options "Right to Left", "Left to Right", and "None" -- default to "Right to Left". When a match is finished for a court for right to left, if there is a court to the right of the court with an active game, the game is moved to the left (and vice versa to left to right). Note that the matchmaking algorithms should not change at all for this feature, just what happens when a score is inputted indicating a game is completed. When finishing a game and sliding a match, add an animation with the court ghost sliding over the other court that it's replacing so it's clear to the user that a court slide action is happening.  

* Currently all of our game-modes operate in a continuous flow kind of system, add a round based system that is configured when creating a new session (make sure to update the GUI so users can select Game-Flow: Rounds, Continuous. When a court finishes in a round based system, all users are moved to the waitlist and no match is scheduled. The next match is scheduled only when the "Next Round" button is pressed. There are 2 new buttons to add to the active session window for Round based game-flows, "Next Round" and "Final Round". Next round is disabled when there is an active court -- all courts must finish before a user can press either "Next Round" or "Final Round". When "Next Round" is pressed, the courts are filled according to what the selected algorithm deems is the best. Note that with round based modes, even if there are imbalances in Competetive Variety Matchmaking, we always fill as many courts as possible given how many players and courts there are at the start of a round. All game mode algorithms are as fair as possible with respect to time waited when scheduling the next round. When "Final Round" is pressed for Competetive Variety Matchmaking, the courts are filled by player rankings. The Top #1 and #4 ranked player play against the Top #2 and #3 ranked player on Court 1. The Top #5 and #8 ranked player play against the Top #6 and #7 ranked player, and so on. The bottom ranked players that don't have a court to play on don't play in the final round. 
## Sliding Revisions
* Do not delete test files. Currently we consider the courts from 1 to N, and if court 2 finishes, 2..N will slide up. We need to instead consider the courts a grid with rows  │
│   of courts. As of now, it's hardcoded to a 2 column x N rows of courts... We need to only do sliding at the row level. if court 1 finishes, court 2 slides to court 1, courts    │
│   3..N stay unchanged. If court 3 finishes, court 4 slides to court 3, courts 1 2 and 5..N remain unchanged (assuming there are 5+ courts). If court 2 finishes, we do not slide  │
│   at all. Update our sliding implementation to do row based sliding.
* Update the Active Session GUI display @python/gui.py  so that games that have just started (as determined by having been active for 30 seconds or less) have a green highlight around them so the user can easily identify which new matches have just been scheduled.
* TODO: Forfeit game doesn't work.

* Transform

# Instruction
* We are only working on the python code right now, not the javascript version of the app. Do not write any implementation documentation or summary files in any format (text , markdown). Do not use EOF syntax to write temporary test files, instead just write the test file and run the test separately. Persist the tests. 
* You don't need to cd to the "pickleball_python_rework" directory to run tests or any python code, that is the current working directory you are in. Commands like 'cd "C:\Users\Ibraheem Saleh\Documents\ProjectDevelopment\pickleball_rework_python" && python test_court_dropdowns.py  2>&1' only need the 2nd part: "python test_court_dropdowns.py 2>&1"
* Whenever you change something related to the Competetive Variety Matchmaking algorithm, you always run the fuzzing tests for it:"make run_fuzz_tests").
* Tests built should have a make target added for them in the Makefile (Do not create new makefiles just for new tests, use the existing Makefile). Always run tests from their make targets, do not tail the output of tests that are run, just parse the entire output (or grep for what you care about!)
* Do not prompt me to run the tests, always run the tests without prompting me. Run the tests without the tail command.
* Never run any git tools.


# Announce when courts are made
* When new courts are made, only people looking at the screen can see that event happen. We need to add an audible announcement whenever a new court is made. There should be a way to enable or disable this feature in the Active Session window (by toggling a sound icon). Whenever a new court is made, a text to voice reader should announce: <*announcement noise plays first 1-2s> "New Match Ready on Court <courtName>, Team <Player1> And <Player2> versus <Player3> And <Player4>.
* The court name needs to be taken from the court name label --- someone can change a court name, even if it has an internal court number.
* If multiple courts are made at the same time, they overlap and are unable to be understood. Make any played announcements play one after the other. 
* The announcment sound needs to be stored locally so it works cross platform, and the current beep is too gentle, get a stringer beep noise.
* Remove all reliance on system sounds, EG sound files with the path "/System/Library/Sounds" --- this feature needs to work cross platform on windows and linux as well.
* The slide action announces a new court, but that's not a new court. We do not need to announce when a court slides.

# Teams Feature
* Some players only want to play together with one other person through the entire session, they do not want random teammates. Update the New Session dialog to support locking players together (IE Player Partnerships). Also Add a Manage Player Locks button on the Active session page to lock players together. Note that players locked together can still be manually swapped in the edit court dialog -- locks are only considered at matchmaking. Update the round-robin and competetive variety matchmaking algorithms to consider player locks. Also, we need to add support for player partnership bans -- players that do not ever want to play together. The controls for locks and bans should be similarly located as they are related. When scheduling matches with locked players, they should always be on the same team. Try to not ruin any of the algorithms by adding support for these locks. The fuzzing tests for when the locks don't exist should still pass!!!!
## Revisions:
* Instead of the Button being called "Manage Locks Bans", have the label say "Manage Partnerships & Bans".
* When adding a partnership, the dropdowns allow you to click "Player 1" and "Player 1", have the dropdown logic be smarter so you can't select a player to partner with themselves.
* If you add a partnership, you should not be able to select either of the two players in the partnership to create another lock.


#Forfeit Feature:
* If you forfeit a match, the same exact players get immediately scheduled on the same court with the same configuration. That's not what should happen, instead that matchup should be skipped and   │
│   not played until other matches have passed.                                                                                                                                                           │
│   * If you add or remove a player, the same 2 people who were just on a team together are often placed in another game being on the same team together -- see @pickleball_session_20251126_113424.txt   │
│   -- Bob Smith and Kate Beckinsale are on the same team together again after having just played a game. The parternship variety rules seem to not work in the event that a player is added/removed mid  │
│   session. Fix the logic here so that it makes more sense.                                                                                                                                              │
│   * The above situations are mostly talking about competetive variety matchmaking, but it could also apply to round robin.
#Revisions
* If you remove a player on an active court, the Match History becomes cleared (show statistics still shows the games that were played)
* If you remove a player mid-session, they should still show up in statistics, and the Export Session results.
* We also get this exception in console:
Traceback (most recent call last):
  File "/Users/ibraheem.saleh/dev/pickleball/python/gui.py", line 1347, in refresh_display
    team1_str = ", ".join(team1_names)
TypeError: sequence item 0: expected str instance, NoneType found
REFRESH ERROR: Error in refresh_display:
sequence item 0: expected str instance, NoneType found


# Dynamic competetiveness feature:
*We need to be more relaxed depending on waitlist size!!!! If the waitlist has 0 or 1 players on it, we need the roaming range bracked requirement to be more relaxed -- IE 65% instead of 50%... If 2, 3, 4 or more are on the waitlist, we need to be more strict!!!
** Implement a UI slider for competetive variety matchmaking on the active session UI to control the competetiveness. It should be located to the left of the "toggle voice announcements" button. There should be 4 positions for it -- Casual, Semi-Competitive, Competetive, Ultra-Competetive, Custom. When casual, is set, roaming range percent = 100. When semi-competetive is set, roaming range percent is set to 65. When Competetive is set, roaming range is set to 50, when ultra-competetive is set, roaming range is set to 35 and opponent and partnership repetition limits are both set to 1. When custom is clicked, a dialog pops up letting the user set the roaming range, partnership, and opponent repetition parameters. -- 
** When the slider is moved, the competetive variety matchmaking algorithm should immediately re-evaluate if it can make any new matches given the condition changes, and use those changed conditions going forward.
** By default when creating a session, if there are 2,3,4 or more people on the waitlist, default to the competetive setting. If there are 0 or 1 people on the waitlist, default to semi-competetive. You know the waitlist size by doing the math: total-players modulo 4, and also taking into account the number of active courts (EG if there are 4 courts, and 24 players, the waitlist is 8 because you can only occupy 16 players at a time due to the number of court constraints). 
* Update custom so that it's not a position on the slider, rather if you double click the "Competitiveness" Label, the dialog to set custom settings pops up. If a user confirms custom settings, the blue slider circle should just disappear.
* Add a "Show Rank" button to the right of the "Show Time Waited" button and styled the same. When pressed, the player rank appears in parenthesis to the right of the player name, EG: "Peter Parker [14]" "Iris West [2]"
* Update "Show Rank" to also add the ranks on the active courts when toggled.
* It appears that there is a bug where moving the competetiveness slider does not reevaluate whether a current match can be made... Verify that that code is actually in place.
* Add a slider for "Variety" that controls the opponent and partnership repetition constraints. It should have the levels "min" "balanced" "max", at "min", the partnership and opponent constraints are set to 1,1. At Balanced, we get what we have now, 3,2. and at Max, we get 4,3. This should also support clicking the "Variety" label to set a custom value for this parameter, similar to clicking the "Competetiveness" label. Make sure to re-evaluate the court situation and whether we can make a new court once the variety slider is moved.
* Remove the fact that setting competetiveness to "Ultra-Competetive" changes the partnership and opponent repetition parameters, it should only edit the roaming range percentage.
* In custom variety settings dialog, let me set the partnership and opponent parameters to 0 (right now it only lets me set it to 1).
* I set custom variety to 0-0, and mode to casual -- which should immediately make a court if there are 4 players available, and no court was made. Clearly The court evaluation is not happening when competetive or variety sliders are moved. They are only happening when a match finishes. 
* Editing the custom "Competetiveness" dialog still has variety settings, but we've moved that logic to it's own variety slider. Update the dialog to only have the roaming range option (and also update us to set it to whatever percent of the current player pool gives us 4 players (EG if 16 players, 25% is 4 players). 
* Add a reset button to the custom dialog that allows us to bring back the old sliders and resets them to the default.
* The custom Variety dialog also needs a similar "Reset to Default" feature.
* Update the custom variety dialog to set the minimum roaming percentage to the smallest percent of the current player pool that gives us 4 players -- for example, if it's 16 players, 25% gets us 4 players. If it's 18 players, it's 23% (make sure you round up!)
* Roaming range can still go to 0% when there 16 players, the minimum should be 25%!
* In the custom competetiveness dialog, the minimum settable value for roaming players needs to be the percentage that gets 4 players -- The roaming range slider should only go from minimum settable value to 100%, not 0 to 100% like it does now.
* Roaming range should NOT appear on the custom variety dialog!
* Bug: Competetiveness roaming range is set to 25%, at max with 16 players, nobody should be able to play with or against anyone not within 4 ranks of themselves, and yet in @pickleball_session_20251214_213217.txt Leo (Rank #2) played with Eve (Rank #8) --- something isn't working there -- The only players he should've been allows to play with are ranks #1, #3, #4, #5, #6.
* Remember, the roaming rank range applies in both directions! If you're rank #2 in a 16 player game with a 25% roaming range, you can play with 25% above, and 25% below you!
* Matches are still being scheduled while violating the roaming range -- something isn't working. 
* Changing the competetiveness slider is not filling empty courts. Also, update the "Casual" competetiveness setting to be 80% roaming range.
* Refactor the competetiveness and variety logic to be profiles, make it easy to adjust and change which profile we use depending on different conditions (EG, like we do now depending on the waitlist size) --- reset it so that if we have 0, 2, 3, or 4+ on the waitlist, we default to competetive mode. If we have 1 on the waitlist, we deafult to semi-competetive.
* partner_repetition_limit and opponent_repetition_limit are part of the variety constraints and need to be separate profile objects from competetiveness constraints.
* If you click someones name on the waitlist or a match in the match history, after the timer ticks 1 second, the selection clears... This is tedious, make it so that the selected element persists past the timer ticks in the active session page.
* You can now have an item selected in both the Waitlist and Match History at the same time, you should only ever be able to select a single item in any pane.
* Now if you select something in Match History, and then select something in the Waitlist, it automatically jumps back to the match history selection after the timer ticks. Also, make it so that if you select something, then click it again, it deselects the item.
* Now when you select an item in either the Waitlist or Match History, it does not appear to have the blue highlight anymore, making it unclear to the user that the item is selected at all.
* The clicking behavior for selection is very unreliable, sometimes it takes 4 clicks to select an item and have it highlighted.
* Instead of using the waitlist size to determine default constraints, use the total players. If we have 13 or less players, set the default competetiveness to Casual. If we have 14 or more players, set the default competetiveness to Competetive.
* Instead of using the waitlist size to determine default constraints, use the total players. If we have 13 or less players, set the default competetiveness to Casual. If we have 14 players, set the default competetiveness to semi-competetive. If we have 15 players, set it to competetive. If we have 16 or 17 players, set it to Casual.  If we have 18 or more players, set it to competetive.


# Easy state reset
* We need to make it easier to track state and go back in time if we choose. Every time a match finishes, store all the necessary state to be able to load the session at that state. If you double click a match in the match history, an "Edit Match Score" pops up -- Instead of just "Save" "Cancel" options, add an option, "Load" which when clicked will load the active session to exactly right before this match was finished. Be careful about your implementation here, make sure any sneaky variables or state that also need to be updated get updated.
* BUG: If a court slide action happens, and a historic match is loaded, the slide action needs to be undone and both the court needs to be set to the original position.
* Scratch this -- seems I was wrong: Bug: When loading a match session from the history, it seems like player variety parameters aren't reset/reloaded, preventing matches from being made that should be made after the loaded match is finished.

* Instructions Button
* Add an "Instructions" button on the active session window. When clicked, it opens an informational dialog with title "Instructions" and bullet points as follows: 
-"Continuous flow mode, not rounds based. There are no timers or rally-scoring, finish your games normally."
-"The computer will tell you where to go. When you finish your game, input your scores and confirm them. You will either be placed in a new game right away or be put on the waitlist and have to wait for another game to finish."
-"When you finish a match on a deep court, and a game is still being played on a shallow court, wait for the point to finish and then have the shallow court slide to your deep court to finish uninterrupted."
-"Red means wall, Blue is net".
-"This is a competetive-variety matchmaking algorithm. The first 2 games are provisional and random, and then it will start to place people in matches according to current performance metrics (wins-losses, point differentials, previous opponents)"

# First bye
* Sometimes when you start a new session, some people need the first bye -- assuming there are people that are going to be on the waitlist, they will be skipped when creating the first matches and guaranteed to not be in the first game. Add a "Manage Byes" button to the Session Setup dialog which pops up a new dialog that lets a user add players to a list to be the first bye. Note that this only works if there are actually people that will be waiting at the start.
* Carrie and Ibraheem were the first bye, the first match finished, and they weren't immediately used to make a court, but they should have been. There's a bug where the first bye logic waits for 2 games to finish before 1st bye players are scheduled for a match, that isn't the right behavior. First bye players should be scheduled for a game as soon as the first match finishes.
* When creating a new session with previous players, have the first bye players saved.
* In session setup, when there are more byes than there should be (for example, if there is 1 court, 6 players, there should only be 2 first byes max), do not let the session be made, have a warning dialog preventing the session from starting until the user removes a player from the first bye list and has a valid number of byes less than or equal to the maximum number of allowed byes specified.
* look at @pickleball_session_20251217_122724.txt , the first game ended, and the first byes are still waiting, per the algorithm, the first byes should be scheduled if it was working properly.
* When starting a new session with previous players, the restored first byes look like "player_14_1766003207.921782" --- that's not right. The new session with previous players first byes should properly add the players from the new session with the same name as before (probably by doing string matching based on the name).
* Look at @pickleball_session_20251217_123120.txt , the same bug as before exists --  the first game ended, and the first byes are still waiting, per the algorithm, the first byes should be scheduled if it was working properly. Think hard and deep about why this bug is happening, and come up with a comprehensive solution that is simple to understand and is coded intelligently and human readably.
* The "Too many courts for N players" validation is unnecessary. It's OK to have more courts than needed for the number of players we have.
* [Bug] When I created a 15 player match on 4 courts and added 2 players to the first byes list, only 1 of those two players was actually on the first bye!!! Figure out what caused this and fix it. Be precise in your fix, and assume the role of a staff level export developer
* You have made it so that you can have more byes than would be on the waitlist --- in a 15 player 4 court scenario, there should only be allowed 3 byes. Restore the warning message that prevents more byes than are waiting.

# Matchmaking bug
* [Bug] Look at @pickleball_session_20251217_173236.txt -- with competetiveness set to Casual, it made the match Ibraheem/Carol vs Alisha/Kimberly... Having thos players is fine, but it's not balanced at all. It should have been Ibraheem/Alisha vs Carol/Kimberly if it was going to make any match with those players. Investigate why matches that are made aren't being balanced. Be precise in your fix, and assume the role of a staff level export developer.

# Time Waited Rework
* We need to rework the times_waited logic -- the counter is not a good enough measure of keeping track of who has waited a long period of time. Instead, we need to look at the total time actually waited for each player and prioritize making match configurations that result in players that have waited the most already not waiting more. We need a threshold at which point the algorithm is not picky to make people wait -- EG, if 15 players are all within 2 minutes of waiting, the algorithm should not care about who waits... But if 13 players are all within 2 minutes of the same total time waited, but 2 other players are within 15 minutes, then make sure those 2 other players that have already waited a lot longer are not put on the waitlist and are prioritized in getting the next available match. This is an extremely complex rework that may have ramifications not described here, be smart in how you will go about this rework and consider other parts of the code where this may effect things. Be precise in your rework, and assume the role of a staff level export developer. Create code that is extensible and maintanable, with logical structure.
* Please verify that the thresholds are based on the time someone waited against the time that the person that waited the least has waited.
* The relative thresholds need to be based on hard time specifications, not gaps like 3x/5x. It needs to be something like a 12 minute gap between the least waited person should mean a waitlisted person should have priority, and a 20 minute gap means extreme priority.
* Here are the github copilot AI reviewed suggestions for this time waited rework, decide if they are correct and should be implemented. The full feature patch for this is in @timeWaitedRework.patch :
===
* In @python/wait_priority.py ; The reverse parameter is not being used correctly. Line 226 returns result if not reverse else result, which always returns the same value regardless of the reverse parameter. This should be result if not reverse else result[::-1] or the logic needs to be corrected to actually reverse the list when reverse is True.
* In @python/wait_priority.py ; The documentation mentions "Dynamic thresholds" but the implementation actually uses fixed time gaps (120s, 720s, 1200s) from the shortest waiter, not dynamic thresholds. Consider updating the documentation to say "Relative thresholds based on fixed time gaps" or "Gap-based thresholds" to more accurately describe the implementation.
* In @test_wait_priority_integration.py ; Variable min_wait is not used.
* In @python/gui.py ; This assignment to 'stats' is unnecessary as it is redefined before this value is used.


# Relative Times update
* Update all the timers to use relative timing instead of times based on the system clock. If I end a session and then resume it, all of the clocks should resume exactly where they left off. If I load a session at some point, all the times should load to exactly what they were before.
* Add support for a --test flag that when set at program start causes the timer to accelerate by 15 seconds for every second, that way we can better test wait prioritization. 
=
* If we resume a session after ending it, all the wait times show as negative. We need to be able to resume a session with the timers exactly where they left off and continue incrementing them normally.
* When we resume a session, the game duration timers still show as negative, that hasn't been fixed yet.

# Tweaks 12-21-2025
* When making the first match, we need to randomly spread the players on the court that are not specified on the first bye list, it should not be consistent between runs but it currently is. 
*  You broke something, in a 20 player 4 court scenario with 2 on the first bye list, the 4th court isn't being populated sometimes, but sometimes it is --- it's inconsistent...
* Explain the reason for artifically limiting the candidate pool, what does having this logic do for our matchmaking algorithm?
* Right now, the courts render on the active courts page as a giant green box, with a division line, and then the side box, and then the team box within the side box and the names drawn within the team box. That is wasted space. Remove the inner team box and just have the side box, and then expand the names to auto fill the entire side box.
** Good, but the names are still not taking up the entire box, is it possible to auto size the text to fill the entire box on the screen?
* When a user renames a court name, and then ends the session and starts a brand new one, they need to rename the court name every time. Persist court names between sessions so long as the number of courts is the same.
* We have added auto scaling for the name sizes on the Active Courts windows, Now we need to auto scale the name sizes on the waitlist.
* For the auto scaling court sizes, if the name causes the scroll bar in the court window to appear, it can bug out and twich repeatedly between having a scroll bar and not. We want the courts to dynamically resize so the scroll bar doesn't have to appear. Please fix this. The problem is the horizontal scroll bar due to name lengths, not the vertical scroll bar.
* Now the courts are taking up way more space and the scroll bar always appears unless I'm full screen. That's not right. The courts need to fit dynamically on the existing space.
* The Match Queue widget is unutilized in the Competetive Variety Matchmaking mode, when the user is playing competetive-variety, remove the Match Queue Widget and extend the Waitlist widget to fill out the space that Match Queue used to take. The Match Queue needs to stay for other game modes.
* You made the Match History section larger, but I asked you to make the Wait List section larger.

# Adaptive Balance
* Even after many games, we still get a lot of imbalanced matches -- a lot of the time it's because of the variety constraints. Analyze the competetive variety matchmaking algorithm. How can we adjust it as the session goes on to get more balanced matches?
* By relaxing Roaming Range, you're lowering the quality of the games. That's bad. We want more balanced matches at higher levels.
* We never want to relax the partnership and opponent constraints to 0 -- at max they should go down to 1.
* The problem is completed matches before relaxation happens is hardcoded to 15, 30, etc... It needs to be dynamic based on the number of players and the number of games they have played. We have 2 provisional matches, then all players should play 2 more (on average) before we start relaxing to the first mid level. Then 2 more again before we relax to the late level.
* Add an adaptive constraints slider like we have for competetiveness and variety. It should automatically change as the match progresses (indicating where we are in adapting the constraints)
* Update @CLAUDE.md documenting the adaptive constraints system.
* I don't understand the adaptive balance slider, it goes from AUTO to MAX, and then says Manual: 8.0x at the bottom... How do I set it to auto and have it take over? Shouldn't it go from NONE to MAX? When it adjusts variety constraints, should the variety slider stay put or change?
* I can go from None/Disabled to Manual, but I don't have an easy way to toggle Auto. Add a state button below it that I can click that changes between Disabled, Auto, Manual, then the slider can be moved depending on the state.
* The states are now Disabled and Manual -- there is no Auto!
* You misunderstood me, I want there to be an auto state for the adaptive balance system (and that should be default) -- we need to add the auto state.
* When I click the state button, it only cycles through Disabled and Manual. It seems like Auto is bugged and doesn't toggle.
* *As auto changes and the match progresses, the slider doesn't move. But the slider should automatically move when the state changes.
* We are working on the adaptive balance feature, see @adaptiveRelaxation.patch ... the problem is, we still get somewhat imbalanced matches with the relaxation in place. As we relax variety constraints, should we not also add balance constraints? Assume the role of a staff level export developer and pickleball match expert with years and years of observing sessions... How would we smartly enforce balance constraints to get better matches as a session goes along? Implement that feature smartly.
* Elite+Weak matches are undesirable... We want Elite vs Elite, Elite Vs Strong, Strong vs Average, Average vs Weak, Weak Vs Weak.
* Remember, these balance constraints should only take effect once the adaptive balance system kicks in (after around round 4)
* Can we add one final constraint once the adaptive balance takes effect, we don't want 2 people to play together, then play against each other, then play together again. We need special handling to prevent exactly that situation.
** Make sure we are considering player-specific match histories when avoiding partner-opponent-partner patterns, not global match histories.
** To be clear, we want them to be able to go from partners-opponents-someOtherGame-partners
*** To be clear, we want them to be able to go from partners-opponents-someOtherGame-partners --- The pattern needs to match from both sides (If there is a gap where one person is on the waitlist and then the game is made is not right, both players need to have atleast 1 game before they play as partners again) --- This is only when balancing is prioritized (as the variety constraints are reduced)
* When adaptive mode incremented after 4 rounds, competetiveness changed from competetive to semi-competetive -- that shouldn't happen. Adaptive mode should not change the competetiveness level ever (IE the roaming range percentage should remain constant even as the variety constraints adapt).

# Pre-seeded ratings
* The competetive-variety-matchmaking algorithm currently starts everybody off at an even ELO rating and then has 2 random rounds at the start... In practice, this seems fine, but in reality, this creates some extremely imbalanced and unsatisfying matches at the start which doesn't even do that good of a job of sorting out who should be at what rating... We want to add the ability to pre seed ratings, which, when enabled, removes the full randomness of the first 2 rounds and puts people skilled similarly against each other...
** Add a "Pre-seed Skill Ratings" toggleable check-box to the right of Game Mode when "Competetive Variety" is selected. If checked, the Players section gets another input where we can input the skill rating in the format (3.0, 3.25, 3.75, 3.80, 4.0, etc). When "Add Player" is pressed, the player and their skill rating are stored (not just the player). Obviously since we need skill ratings for players, if players are already inputted and "Pre-seed Skill Ratings" is clicked, all players need to be cleared from the "Total Players" section.
** When we pre-seed skill ratings, we don't need to wait 4 rounds for Adaptive Balance to kick in since we already roughly know each players skill level -- update the algorithm to only wait for 2 rounds before adaptive balance kicks in. 
** When we do a new session with previous players, we need to also restore the pre-seeded ratings for the players if it was a pre-seeded match previously... Update the logic so that if it was pre-seeded match before, it new session with previous players defaults to a pre-seeded configuration. And if wasn't a pre-seedd configuration previously, it defaults to not being pre-seeded.
** Update "Add 18 Test Players" to randomly pre-seed skill ratings if pre-seed is selected.
** Assume the role of a staff level expert developer and pickleball match expert with years and years of observing sessions... If there are changes that still need to be made for this system to be complete with pre-seeding, add them.
* The check mark for Pre-seed skill ratings is the same color as the background, make it white.
* When I click Pre-Seed Skill Ratings, it fills out blue. Make it so that it's a white check mark with the standard theme background.
* Update the label from "Pre-seed Skill Ratings" to "Pre-Seed Skill Ratings"
* Change the default mode to be "Competetive Variety" with "Pre-Seed Skill Ratings" checked.
* There's a bug: Could not create pixmap from data:image\svg+xml,%3csvg xmlns='http:\\www.w3.org\2000\svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='white' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z'\%3e%3c\svg%3e
* Yes we have a blue border when selected now, but can we also have a checked box?
* New session with previous players doesn't work with pre-seed, all the players get cleared every time (and the dialog comes up when I click New session with previous players saying: "Pre-seeding skill ratings requries clearing existing players" -- that's not true, if the last session was pre-seeded, we shouldn't have to clear!), even if the last session was a pre-seeded session... In the event that the last session was not pre-seeded, default to 
* When "New Session with Previous Players" is selected, the players are being loaded without the pre-seeding (even if the last match was pre-seeded!) -- Take the role of an expert level developer and fix this bug.
* When "New Session with Previous Players" is pressed, first check the game mode configuration of the previous session and set that up (including whether or not skill ratings were pre-seeded). Then after setting the session configuration to match the previous game mode, load all the players (including their pre-seeded ratings if it was a pre-seeded game)
* New session with previous players is still not working to create a new pre-seeded session with previously pre-seeded players. I start a session with pre-seeding enabled and players having their skill levels set, then end it, and start a new session with previous players, but pre-seeding is not set, and the players are loaded without their pre-seeded skill levels.
###
* When filling the courts for a pre-seeded session, the games are being created with random skill levels... Instead, we should create games as follows #1,#4vs#2,#3, #n,#n-3vs#n-1,n-2,#5#8vs#6#7 --- And keep up that pattern depending on the number of courts we can fill -- we pre-seeded, so we know relative skill levels. Make a court from the top of the pool, make one from the bottom, top again, bottom again, etc...
* After the initial pre-seeded round, we are still just filling courts randomly... But we need to be filling courts with as much balance as possible instead. Since we are pre-seeding, we can make balanced matches from the start -- we do not need to wait 4 rounds!
* Look at @pickleball_session_20251223_142128.txt -- court 1 is #2,#5 vs #1,#3 -- it should be #1#4,vs#2,#3, unless 1,2,3,4 are on the waitlist, which they're not. Court filling should be deterministic at the start when pre-seeding.

# deterministic waitlist
* People on the wait-list get tired of waiting very quickly, especially since they don't know how long they are going to be waiting for. Build an advanced system that evaluates current matches and the statistic changes that occur if a match finishes. Based on a players current ranking on the waitlist, and the rank changes that would happen if matches finish with either side as the victor, update the waitlist to show what courts a player on the waitlist is waiting to finish before they will get their next game, EG: Noah Taylor[Court 1R, Court4RB] if Noah will get a game if either court 1 finishes and the red side wins or court 4 finishes and either the red or blue side finishes...
* When I click Show Dependencies, I don't see anything, I think the font for the dependencies is not visible.
* Dependencies aren't working: DEBUG: Dependencies for player_0_1766531262.826098: {} DEBUG: Dependencies for player_11_1766531262.826193: {} --- 
** Refactor the code to share the same evaluation loop as the dependencies calculation function so that when we add or remove competetive variety algorithm steps, the calculation also updates. This is a complex feature that requires deep thinking.
* For dependencies, keep the name size large as it is, but have the courts listed as small sub text.
* Update Export Session functionality to also include the courts that people on the waitlist are waiting for in the Waitlist section.
* Look at @pickleball_session_20251223_153405.txt , it shows that if Court 1 Red or Blue finish, Diana Prince will get in a game, but if Court 1 Red or Blue finishes, other people on the waitlist actually get the game (Rachel & Frank vs Henry & Charlie) --- The problem is, the deterministic waitlist is not taking into account who gets priority for the game being made, which needs to happen.
=======================
Look at @pickleball_session_20251218_191723.txt -- Ibraheem Saleh, Patrick Carroll: 11 beat Robert Dillon, SKyler
   Hensley: 0 and Ibraheem Saleh, David Laforest: 11 beat Ellie Farias, Sheila B.: 5 -- That is NOT how the balance
   should have been made!! Roaming range was set to 100%, so anyone could play with anyone. Ibraheem should have
   been with Sheila and David witih Ellie (given the balanced variety setting)!!! The @python/competitive_variety.py
    algorithm is clearly NOT balancing matches that are being made properly. Investigate why matches that are made
   aren't being balanced. Be precise in your fix, and assume the role of a staff level export developer.


# Rounds based King of the Court
* We want to implement the king of the court algorithm using a rounds based mechanism -- courts do not populate until all currently scheduled games are finished.
* The algorithm is simple, When a game finishes, the team that won move up a court and split (unless they're already at the top kings court, in which case they they stay there and split), and the team that lost move down a court and split (unless they're already at the bottom court, in which case they stay there and split). When the winners from the lower court are joined with the losers from the previous upper court to make the court in the next round, the only thing to prioritize when making the match and choosing who teams with who between those groups is avoiding repeat partnerships whenever it is possible. 
* If there is a waitlist, we primarily choose people to be on the waitlist from the middle courts first, then the bottom court, then (and only if everybody on all the other courts have waited once already) do we choose people from the kings court to wait. We never have anybody wait again until everybody else in the session has waited atleast once. When people come off the waitlist after having waited, try to put them in the same position they were before. If they are the first byes or happen to be the first ones who waited, try to place them anywhere in the middle courts.
* Courts need to have a sense of direction for players moving up and down after winning and losing. By default, the courts can have the direction starting with Court 1 being the kings court and the last court being the bottom court.
* Add a button to the active session page to be able to modify the court ordering. It should be an ordered list, where we can move courts (via their court name) up and down on the list. Similar to court names, court ordering should persist between sessions.
* For the initial seeding of players, we want 3 options -- Random, Highest to Lowest, Lowest to Highest. Add an option to the Session Setup page for the user to select these options when game mode is set to "King of the Court". If Random is selected, players are randomly placed across the court; If "Highest to Lowest" is selected, top players are placed in the Kings court and lowest players are put in the bottom court; if "Lowest to Highest" is selected, the lowest ranked players are put in the kings court, and the highest ranked players are put in the bottom court. Note that we still pay attention to selected First Byes in all configurations!!!
## Tweaks
* Update the @CLAUDE.md file documenting the new King of the Court implementation.
* When all the courts finish, the next round is not being automatically made (courts are stuck at "Waitin for Players".)
* Since Highest to Lowest and Lowest to Highest configs require skill rating inputs, we need to support that like we do for Competetive Variety with "Pre-seeded Sklil Ratings"
* Round advancement has a match tracking bug where completed matches from different courts are being stored with the same court number. This prevents proper winner/loser movement between courts. The issue has been identified but deferred since the basic King of Court functionality works perfectly.
* I just finished a match in @pickleball_session_20251230_111559.txt and immediately court 1 was automatically filled with the next match! That is wrong, we need to have king of the court be round based!!! Only schedule matches after all matches have finished, and use the string moving-up and moving-down logic that king of the court expects!!!
* Manage Court is using internal name for the ordering which makes it confusing -- the user sees the name on the label in the Active Session GUI. We need to have the court name reflected be the same name that is on the visible label.
* Look at @pickleball_session_20251230_112402.txt, Kimberly and Leah won a match, and moved up a court, but then stayed together as a team! The King of the Court algorithm is simple, win a game, move up and split, lose a game, move down and split... Also Brock and Sheila won, but then moved down instead of moving up. Assume the role of a staff level export developer and fix the algorithm to properly be a king of the court algorithm!
* Look at @pickleball_session_20251230_113316.txt , players are splitting after winning together, but they are not moving up in the court ordering, they are staying there. After the first round, Ibraheem stayed on the waitlist, which means he waited twice -- nobody should ever wait more than once in round based king of the court!!!! David & Jeremy lost on court 1, then moved to court 4! They should have moved to Court 2 and split!!! The algorithm is still very much not working as intended!!!
* Refactor the GUI code so that it doesn't manage session advancement logic itself anywhere -- that is bad organization since the GUI code is hard to test, and we need to be able to test this logic wherever it lives! Court population, session advancement logic, etc should be defined in the algorithm or session files, not in the GUI code. Make sure the tests work after the refactor. Take the mentality of a super extremely expert developer when refactoring the code to make it more maintainable.
* Look at @pickleball_session_20251230_130450.txt , Ibraheem and Patrick won and should've moved up to Court 3 and faced each other. Somehow they ended up on different courts. Greg and Jo lost on Court two but somehow ended up staying on court two (though they did split correctly.) This needs to be fixed. The court order mechanism needs to work properly.
* Build a comprehensive unit test that evaluates 6 rounds of a 19 player king of the court. At the end of each round, Validate that the winners moved up and split, and the losers moved down and split (or either the winners or losers were substitued with wait list persons). Also, at the end of each round, validate that nobody waiting has waited more than once overall -- with 6 rounds, we should have 18 players having waited only once each in total. Validate that court ordering is being respected. The algorithm should enforce court ordering and basic king of the court behavior over partnership constraints!!! Partnership uniqueness is only factored in when choosing which of the losers will combine with which of the winners from the previous round!!!
* It is probably better the algorithm works by first moving all the players that played in the previous round and splitting them per the king of the court algorithm, and then doing a swap action with waitlist players AFTER the king of the court algorithm has been applied.
* Do not apply competetive-variety specific constraints to king of the court, they are different algorithms!!!!
* Bug -- after everybody has waited exactly 1 time, the waitlist becomes stuck and people that are on it never get off again. See @pickleball_session_20251230_142508.txt for a real example, Ibraheem Greg and Brock are on the waitlist for 3 rounds in a row at that point... Instead, we need to continue the logic so that once everybody has waited once, we start swapping out players for the waitlist starting from the first people that waited to the last people that waited (that way there is a long time between waits, and people don't get back to back waits) -- to achieve this, we will need to keep track of a waitlist history. Update the export session logic to also include the waitlist history.
* Court Order updates are not persistent between sessions, update Court Order so that any user specific changes to court order in king of the court persist between sessions, the same way that Court Name Labels persist between sessions.
* "Export Session" needs to also update the waitlist history in king of the court matches.
* Look at @pickleball_session_20251230_145701.txt , some people have waited 3 times while others have only waited 1 time. Waitlist history should be an ordered list, once people wait once, the order is determined and we just swap out players directly using the ordering in that list.
* When we export the wait counts, we should have the export ordered according to the ordering of the waitlist history.

# Continuous flow 
* Singles Round Robin works almost perfectly, but first bye support isn't there. Add it the specified first bye is actually the first-bye.
* With 9 players, there should be 36 matches total. After the first bye change, I only see 24 matches queued and 4 on courts (28 matches total) -- something broke. It should be 32 matches queued and 4 on the courts -- Add a test that validates 36 total matches for 9 players single round robin.
* Bug -- The first bye players are stuck on the waitlist! See @pickleball_session_20260101_215839.txt

# Competetive Round Robin 
*With 19 players in a session, there are 3876 unique player combinations possible for pickleball games... In an average session, we only play about 6 to 9 games per person... It is very difficult to find the ideal games that we want to play for a session given so many possibilities. To address this, we want to create a new Continuous Flow Competetive Round Robin game mode. It takes a pre-seeded list of players with their rankings, and generates N matches to play in a session. The key here is, on match creation, the session administrator creating the match will go through and approve all the scheduled matches. If the admin rejects a match, a new match is automatically generated to fill in for those N matches -- any previously approved matches are untouched, but future matches to be approved might shift to account for the adjusted matches. The key to this feature is the human-in-the-loop approval of all scheduled matches. The interface for that needs to be robust and intuitive. Assume the role of a staff level export developer and pickleball match expert when building out the necessary components for this UI window.
** When generating the matches, we want to keep some constraints so that each player gets a fair amount of play time... Each player should be scheduled for 8 games in total. Using the pre-seeded player skill ratings, we should have mostly competetive matches as possible. If a high and low level player are together, they should be against a high and low skill level player. If a low and low skill level player are together, they should be against low and low skill level players. Of course, every player base is unique, and perfectly fitting the skill constraints is impossible, so it should all be relative. It might help to bracket players according to their skill rating to try to get the most fair games.
*** Another particularly important constraint is that with so many potential player combinations, we really want to limit the number of matches that are generated that have repeat partnerships. Nobody should play with the same partner more than once in their 8 games. It's OK to play against the same opponent more than once, but you should also not play against the same opponent pair more than once, and in total for 8 games, you should not play against the same person more than 3 times total. 
*It is impossible to perfectly schedule an entire session using just algorithms, that is why we need a new UI window that enables the user to go through and approve, reject, or swap players for any given match. In the Session Setup page, there should be a new "Manage Matches" button when "Competetive Round Robin" is selected. This allows a user to interact with the matches that the algorithm has scheduled for the session to make them better given their knowledge.
* We should play the games similar to how round robin games are played -- prioritizing making matches for people that have waited more times than people that have waited less times at any given point. 
# Tweaks
* Brenda & Brock did not get 8 matches scheduled -- always generate enough games so that everybody gets atleast 8 matches scheduled.
* For an outlier like Brock who is a 4.5 rating when the closest matches are 4.0, instead of always trying to compensate for that by pairing Brock with a low rating player like a 3.5, try to create quality matches where 4.5 plays with 4.0s, that keeps it fun for everyone... The same reasoning needs to be applied to low level players like Brenda at 3.25, don't try to always give her high level players, try to make some matches where all the lowest level players are together with her.
** Most of Brocks games were generated later in the match approval window... Try to evenly sparse the games and players so that the match queue fairly distributes who is playing and who is waiting.
* After approving the matches and starting the session, no games were actually queued -- all the courts were stuck "Waiting for Players" and the "Match Queue" item was empty, it seems like the matches were not added to the queue.
* While swapping players in the match approval screen, I could only swap players that were not assigned to other positions on the court... Add the ability to swap players assigned to one team with players assigned to the other team.
* Add the capability to export and import generated matches via the Manage Matches screen.
* Add the capability to export and import player lists and match configurations via the Session Setup page -- this export/import feature should include the assigned rankings when ranking-based game modes are enabled.
* Make sure that competetive round robin supports the First Bye feature so that matches aren't assigned for the first bye players.
# Tweaks 2
* After I approve a match in the Manage Matches window, I should be able to unapprove it (the same way that I can swap players after approving)
* In the Session Setup window, the "Export Players" and "Import Players" buttons only take up half of the dialog horizontally, they should expand to take up the whole dialog horizontal width (each taking half the available space).
* The Approved Matches do not appear in the Match Queue, but they should.
# Tweaks 3
* The system isn't flowing very well -- For example, in a 4 court scenario with 20 players as specified in @players.json , we often find ourselves in scenarios where only 3 of the 4 courts are in use, and the last court is waiting for players to finish, even though 8 players are on the waitlist! I think we need to generate more matches for the queue for things to flow better, let's make the 7-9 matches generated per player range configurable on the "Managed Scheduled Matches" window.
* On the Manage Scheduled Matches window, add a button "Regnerate All" that rebuilds the entire list with the new player range configurations.
# Tweaks 4
* Update the competetive-round-robin algorithm to do Round-based generation: Instead of generating matches one-by-one, generate them in "rounds" where each round has N matches (N = number of courts) and no player appears twice in the same round. This guarantees all courts can be used simultaneously.
* Also add Batch scheduling: Group matches into batches of 4 (for N courts) where each batch has N*4 unique players (assuming there are enough players to fill those courts)
# Tweaks 5 - more mixing
* Look at @pickleball_session_20260104_205625.txt , Payton, Jeremy, Johnny, and Toni play 3 matches together with different configurations... That can be extremely frustrating and boring. The competetive-round-robin matches that are generated are not creating enough variety. We need to create more matches with skill mixing -- EG 4.0 3.5 vs 4.0 3.75 , currently, we most of the matches generated emphasize keeping the skill ratings the same, EG 4.0 4.0 vs 4.0 4.0, that's great, but in rec play, we want more variety while keeping matches relatively balanced. Make sure the generated matches have more mixing (but we still want the high skill matches to also be included!)
# Tweaks 6
* Much better! Now, lets tweak the algorithm to emphasize more similar skill matches for the first 1st generated round, and then do the more mixing that we just added here for 1 round... Keep cycling back and forth between similar skill emphasis and variety emphasis until the necessary number of matches are generated... That way we get a good variety of match types throughout the session.
# Tweaks 7
* I am still struggling with continous flow of the session -- we are ending up with empty courts waiting for multiple games to finish too often. Look at @pickleball_session_20260104_212522.txt, we are only 2 games completed, and already a court is waiting! What is wrong wtih the schedule @competitive_round_robin_schedule.json ? What update do we have to make to the competetive-round-robin algorithm to help make the continuous flow less interrupted by waiting?
* Update @CLAUDE.md explaining the competetive-round-robin algorithm and adding other neccessary documentation.
* Look at @competitive_round_robin_schedule.json , Brock is only being generated 4 of the necessary 8 matches... is it possible to keep continuous flow but still generate atleast 8 matches (or whatever the specified configuration is) for each player?
# Tweaks 8
* Look at @pickleball_session_20260104_223852.txt , the session had beautiful continuous flow, but honestly, opponent repetetion happened too frequently. Jim and Cleo played with each other 3 times, can we achieve the same continuous flow property while limiting repetition to 2 times?
# Tweaks 9
* The continuous flow doesn't work well in the 18 player scenarios -- see @pickleball_session_20260104_224925.txt . Can we generate better flowing matches somehow in the 2 always on the waitlist scenario or no? It seems like Jim & Greg vs Payton & David would have been an OK match to generate, but we don't have it in this session.
* Make it so that if we do competetive-round-robin and we don't manually approve and manage the matches, they all become auto approved when "Start Session" is pressed.
* Falling back to competetive-variety is not a good solution, we need to augment the wave function to generate a good set of matches for continuous flow. Should we maybe just generate more matches?

# Competetive-round-robin and continous-wave-flow
# The competetive-round-robin algorithm has turned less competetive and into more of a continuous-wave-flow algorithm... That's fine, but we still want to implement competetive-round-robin. Duplicate competetive-round-robin as continuous-wave-flow, and then modify competetive-round-robin to work more like a round-based algorithm. We do not want matches to continuously populate the courts as players become available, instead, we want to wait for all courts to complete before scheduling the next round of games. Because this is rounds based, we can and must be completely fair with who waits in each round, and hard restrict anybody from waiting twice before everybody else has waited atleast once -- same thing as the session goes on. We still want to generate a limited number of rounds that we control and approve in the "Manage Matches" feature before starting a session. Also show the players that are waiting in the "Manage Matches" UI for each round and enable the admin to swap out who waits when as part of the UI. 
* For the new continous-wave-flow algorithm, "Manage Matches" should still exist, but it only generates the first round. We need to update the continuous wave flow algorithm to re-evaluate the next matches everytime a game finishes, and it should always make a match with available players, prioritizing making a match with the players that have waited the longest, and then making the most balanced match possible with the 4 selected players that are in the match. Variety constraints are attempted to be enforced, but we do not block making a match when that's not possible. There should always be swapping of atleast 2 players between matches -- warn the user when the number of players on the waitlist are less than 2 since that doesn't play nicely with the algorithm.

* For continuous-wave-flow Manage First Round, I cannot edit the configured matches or swap the players at all. Also it doesn't show who will be on the waitlist.
* For competetive-round-robin Manage Matches, it just shows a list of matches. We need to add more items to the Manage Scheduled Matches window -- Every round, we need to Add a label saying Round <$RoundNumber>, We also need to add a Round Waitlist Item before the Round Label showing who will be waiting in that round (the players not scheduled on courts for the round).
* If we swap a player in the competetive-round-robin schedule matches, they are not actually swapped, EG, if we swap Jim K on Court #3 with Jeremy on Court #4, Jeremy ends up scheduled on both Court #3 and Court #4
* Look at @pickleball_session_20260105_195625.txt for competetive-round-robin, Payton is playing back to back games with and against Gray and also back to back games with and against Johnny. This is boring. We now schedule all the games at the start of a round, so we should be able to control when players play multiple games back to back (whether its against or with a certain player). Since this is a rounds based algorithm, we can make variety more fo a priority, update the algorithm to prevent this scenario.

*Look at @competitive_round_robin_schedule.json , Round 7 only uses 3 courts -- and then it jumps to Round 9! What happened to round 8?!?! Round 9 also only uses 3 courts. All rounds should always use all the courts.
* The "Manage Matches" export/import doesn't include the round information, please include it for clarity. It also doesn't include the waitlisted players, please include them for clarity.

* Look at @pickleball_session_20260105_210512.txt , Ibraheem's last 3 matches included David, but there are 18 players in the lobby! There is no reason to have so little player variety when scheduling these competetive-round-robin matches! There are 3,060 unique pickleball game combinations possible with 18 players. Memory and computer power is cheap, as part of the competetive-round-robin algorithm, generate all possible matches for the given player combinations and calculate the expected balance for each match. Then use this list of generated matches to create the games for our session. Remember, we want to alternate between creating Highly competetive rounds where the best players face off against each other (with some variability), and some mixed rounds where 2 higher players play with 2 moderate players (or 2 moderate players with 2 relatively lower level players), etc... Variety is a HUGE part of a recreational competetive-round-robin, we can  not ignore that. Make sure the variability in our matches exist, and write a test that enforces this round generation technique (competetive, mixed, competetive, mixed, and so on).

* You wrote "test_player_variety_across_matches: Ensures no pair plays together more than 5 times" -- we don't really want a pair to play together more than 1 time. Sessions only last around an hour and a half with 18 people... We should be able to mostly have it.

* Look at @pickleball_session_20260105_212336.txt , Brock is an outlier high level 4.5 player while the next highest in the session are 4.0 players. The algorithm currently generates competetive matches with Brock by pairing him with low 3.5/3.75 level players, instead of making elite games with 4.5 and 4.0 players only... We need to augment the competetive round behavior to make more elite matches for players like Brock, instead of always balancing, because playing with low level players on your team can be boring for players like Brock -- that's OK for variety rounds, but not so much for competetive rounds. The same thing is going to apply for low-level outlier players, they should play as close as possible with other low-level players, not get high level-players alongside them in the competetive rounds to balance it out.

# Manage Matches Enhancements
* We want to improve the usability of the "Manage Matches" interface. 
** Make it so that we can easily swap player positions within a match by just dragging & dropping the names to a side over another player -- whoever they are dropped over will swap with the dragged player. We should also be able to drag & drop players between different courts.
** Make it so that we can drag players over the players on the waitlist, and it will swap the player on the court with the player on the waitlist. This action should cause rounds below it reconfigure so that player that is no-longer on the waitlist is on the waitlist in a further round-- BUT, it should NEVER alter rounds below the rounds that are being configured (EG, if I change a waitlisted player on Round 5, we should not alter Rounds 4,3,2, or 1 at all).
* Add a new Round type named "Ultra Competetive" which just puts the highest ranking players together (excluding the waitlisted people in the round) and keeps on filling courts until the lowest ranking players get the last court.
* Make it so that clicking the header of a round will toggle between the different round types and regenerate the round configuration (it should not change who is on the waitlist) -- we should be able to swap between all the round types (VARIETY, COMPETETIVE, ULTRA-COMPETETIVE). Similar to the waitlist alterations, changing configuration on a round, should automatically trigger further rounds to auto-reconfigure (but again, we never alter rounds below the round we're changing (EG, if I change a waitlisted player on Round 5, we should not alter Rounds 4,3,2, or 1 at all)

# competetive-round-robin Enhancements
* Always start with an ultra-competetive configuration for the first round. Then do Competetive, and Variety swapping.
* Always prefer to have lower level players (the bottom 40%) be waitlisted on competetive & ultra-competetive rounds, and have higher level players (the top 40%) prefer to be waitlisted on variety rounds. (obviously we still try to be completely fair with who gets on the waitlist on not override these preferences to avoid repeated waitlisters for rounds).

# Bugs
* The subsequent regeneration of matches is completely breaking the system, rounds are being regenerated with less than the maximum number of courts being filled. Build a test that tests the functions manage scheduled matches uses, and add tests that ensure these capabilities work as expected.
* After switching from competetive to ultra-competetive, the courts shuffle. But then when shifting from ultra-competetive to variety, the courts stay the same. Switch to variety should cause some randomness to be introduced that ultimately shuffles the players on the court and creates a unique round. 
* Add a button at the round level in the Manage Scheduled matches window to regenerate the entire round dynamically. I should be able to repeatedly click this button until a round I like is created.


* In the Manage Scheduled Matches window, there is a warning that shows some constraint violations have been found, EG 11 constraint violations found. That's OK, but I have no idea what they are. Make it so that I can click on that and see what the constraint violations are.
# Competetive-Continuous-Round-Robin
* Duplicate the competetive round robin code and create a new competetive-continuous-round-robin format. We still

# Competetive Variety Improvements
* Rework the initial round creation for competetive variety matchmaking, it should instead try to be ultra-competetive as it is in competetive-round-robin -- basically filling the courts top 4 players from list, bottom 4 players from list, top 4 players, bottom 4 players, and so on, until all the courts that can be made are made.
* Delete the complex time-waited override system for competetive variety matchmaking. Instead, use a simple system that requires a player to be put in the next match as soon as 2 courts have completed. Remember to keep track of this stat on a per-player basis.

# Pooled Continuous RR with Crossover
* We are creating a new game mode titled "Pooled Continuous RR with Crossover" it works as follows: Players are put into different pools (2 pools are the default but more can be added). A round robin algorithm is used to schedule all the matches for a pool -- everybody should play everybody exactly once in their pool. Once each pool plays all the matches assigned to it, a crossover event happens where the top #1 ranked player from each pool plays against each other, and the top #2 ranked player from each pool plays against each other, and the top #3 ranked player from each pool plays against each other, and so on.
** Add a label to the right of the court name label on the Active Session window, when crossover matches are happening, the label should say "Crossover Rank 1", "Crossover Rank 2", etc, depending on where the crossover is happening in the pool (top 1, top 2, etc)
** When a court frees, the next match that gets selected should include players with the least number of games played, that way the pool finishes in the most even/rapid time possible (otherwise if the same player plays all their matches first, then they will wait a long time for other playesr to finish theirs-- we need to be balanced and fair with play time here).
* Add a button in the "Session Setup" window labeled "Manage Pools" -- When clicked, this opens a new dialog for managing which players belong to which pools. It should be located where "Manage Matches" is when "Competetive Round Robin" is selected (The "Manage Matches" button shouldn't appear when "Pooled Continuous RR with Crossover" is selected since that's not used with this mode).
** The "Pool Manager" window should automatically randomize putting all the players into two pools split evenly. There should be a button to "Add Pool" which adds another pool and again randomly distributes all the players evenly across all the current pools. Similarly, a user should be able to delete a pool. There can be no less than 2 pools for this mode. 
*** In the "Pool Manager" window, a user should be able to drag and drop players between pools, similar to how they can be dragged and dropped in the "Manage Matches" window. 
*** In the "Pool Manager" window, there needs to be a way to dedicate certain courts to certain pools. By default, any pool matches can be played on any court, but we should be able to limit which pools play where -- for example, Pool 1 should be able to be limited to playing only on Court 1 and Court 2, while Pool 2 can be limited to playing only on Court 3 and Court 4. When all the matches in a pool are played, but matches in other pools still need to be played, they will be assigned to any available courts that were dedicated to the now finished pool (they are no longer pool locked).
* When "Pooled Continuous RR with Crossover" is being played, the Active Session window should have a new button next to "Show Statistics" titled "Show Pool Statistics" -- When clicked, it should show the relative statistics for each pool, and where each player stands with respect to wins/losses/pt differential/etc -- every stat that we currently track in "Show Statistics".  The "Show Pool Statistics" window should also have a concise table view showing who has defeated who in previous matches. 
* When all the round robin and crossover matches are played, a window should pop up titled "Winners!" showing the top 3 players and having Gold/Silver/Bronze medals next to their names. The window should use big font and look celebratory --- these are the winners of the session!!!!!!
* Be careful not to break any of the other game modes or existing functionality, we are mostly just adding new stuff here.

## Pooled Cont RR - 2
* In the "Session Setup" window, "Pooled Continuous RR with Crossover" should only support "Singles" session type -- when selected, remove "Doubles" from the "Session Type" dropdown options.
* The "Match Queue" doesn't show the queued matches for "Pooled Continuous RR with Crossover" mode, but we know all the matches that need to be played, so it should show them. Please add all the queued pool matches to the "Match Queue"
* [bug]"Show Pool Statistics" throws an error: 
Traceback (most recent call last):
  File "\\wsl.localhost\fedoraremix\home\isaleh\dev\pickleball\python\gui.py", line 6745, in show_pool_statistics
    win_pct = (standing['wins'] / standing['games'] * 100) if standing['games'] > 0 else 0
                                                              ~~~~~~~~^^^^^^^^^
KeyError: 'games'
* [bug] All of the matches finished in "Pooled Continuous RR with Crossover" mode, but no winner dialog was displayed. The winners dialog code should probably trigger on match completion, after doing a simple check of if there are any more matches queued (obviously, this trigger needs to happen after the cross-over matches trigger happens).

## Pooled Cont RR - 3
* [bug] When selecting "New Session with Previous Players" when the game mode was "Pooled Continuous RR with Crossover", the "Session Setup" window shows "Competetive Variety" instead of "Pooled Continuous RR with Crossover"... Make it so that New Session with Previous Players properly selects "Pooled Continuous RR with Crossover" when the last match played was "Pooled Continuous RR with Crossover".
* Using the same label that we have for "Crossover Rank", when the pool matches are being played, have the label say which Pool the match is from, EG "Pool 1 Match", "Pool 2 Match", etc...
* "Show Pool Statistics" shows Gold/Silver/Bronze while the Pools are in progress, only show that once all the pool matches are complete.
* [bug] In "Show Pool Statistics", the "Head to Head Results" table doesn't actually show any results for who defeated who.
* [bug] If you resume a "Pooled Continuous RR with Crossover" session and click "Show Pool Statistics", an error pops up "Not in Pooled RR mode", but we are resuming a pooled RR mode so it should work.
* When in "Pooled Continuous RR with Crossover" there are no Partnerships or Bans, so that button shouldn't exist in this case. Remove "Manage Partnerships Bans" from the Active Session and Session Setup windows when "Pooled Continuous RR with Crossover" is selected or running.
* Text shows "Pooled-Continuous-Rr" with Rr being capital then lower case, update it so that RR is both capital, IE: "Pooled-Continuous-RR"
* When a "Pooled Continuous RR with Crossover" match finishes, add a "Show Winners" button at the bottom of the Active Session window that manually brings up the Winners dialog that automatically pops up at match completion.

## Pooled Cont RR - 3
* Update "Show Winners" so that the button only appears after all the cross-over matches have been played. Do not display the button until the match is complete.

## Improvements
* When filling a court with a queued match, randomize which side each team starts on for "Round Robin" and "Pooled Continuous RR with Crossover", otherwise players will always start on the same side -- be careful not to break anything that might have previously relied on which side players for a team are on!!!
* Rename "Round Robin" mode to "Continuous Round Robin"
* Delete "Continuous Wave Flow" mode -- that is a failed algorithm.
* For "Pooled Continuous RR with Crossover" in the "Manage Pools" window, the schedule preview didn't automatically recalculate after dragging/dropping players between the pools. Fix the Schedule preview to automatically recalculate after the user drags and drops players between the pools. In fact, it seems that there is a bug when dragging and dropping a player from pool 1 into pool 2, the player that was dragged is dropped. This is a critical bug that needs to be fixed.

* In "Pooled Continuous RR with Crossover" for the active session window title at the top showing Courts Queued Completed -- Queued is 0 even though there are many games queued.

* For "Pooled Continuous RR with Crossover" the winners aren't the players with the most point differential or highest stats, they're the top players and winners of the crossover match -- if there are 2 pools, #1 gold is the winner of the #1 crossover match, #2 silver is the loser of the #1 crossover match, and #3 bronze is the winner of the #2 crossover match. If there are 3 pools, the top three players are all from the #1 crossover matches ranked by how many crossover matches they won and point differential.

* For "Pooled Continuous RR with Crossover" update the "Export Session" option to export the session winners based on how we just calculated them from the crossover matches. Also, update the "Export Session" option to export pool statistics and crossover match results.
* Update the "Export Session" feature for all modes to also export a PLAYER STATISTICS CSV section right after the PLAYER STATISTICS with the exact same data, just in CSV formatting.
* [bug] In "Pool Statistics" for the crossover matches results page, the results always show 11 - something , with the winning score being on the left and the losing on the right, but the table is printed in an ordered fashion where the winner might be on the right and the loser on the left. Fix the crossover matches pool statistics page to make sure the result orientation is correct for where player1 and player2 are on the table given who won.

* [bug] In "Pool Statistics", the head to head results table is not showing correct wins/losses due to player side randomization.
* [bug] there is an export error now: EXPORT ERROR: Error exporting session:
'charmap' codec can't encode character '\U0001f947' in position 2998: character maps to <undefined>
Traceback (most recent call last):
  File "\\wsl.localhost\fedoraremix\home\isaleh\dev\pickleball\python\gui.py", line 5952, in export_session
    f.write(export_text)
    ~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\Ibraheem Saleh\AppData\Local\Python\pythoncore-3.14-64\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\U0001f947' in position 2998: character maps to <undefined>


* Auto text resizing for the Waitlist in "Pooled Continuous RR with Crossover" doesn't seem to be happening, make sure the "Waitlist" text automatically resizes to use as much space as it can.
* [bug] See @pickleball_session_20260201_194456.txt , Ibraheem lost twice, but pool statistics shows him as 4-1. Pool statistics should be 3-2
* 

# Not sent -- TBD
* Look at @pickleball_session_20260105_221745.txt , the algorithm insists on having players that played together play against each other in the next round, or having players that played against each other play together in the next round... That SHOULD NOT HAPPEN SO REGULARLY. If we have 8 rounds configured, those back to back configurations should happen as spread apart as possible. Analyze the session distribution that gets generated, and shuffle rounds around to make inter-round variety much better. 

# First Bye Fixes
* On Mac, I'm constantly seeing this annoying message: "QPainter::end: Painter ended with 2 saved states" -- make it so that this message doesn't print in the console.
* First bye doesn't work for singles -- I get the error "With 12 players and 4 courts, maximum 0 players can have a first bye. You have 2 selected. Please remove 2 player(s) from the bye list" -- this is not correct for singles because with 12 players and 4 courts, you only need 8 players to fill the courts, so we can technically have 4 players on the first bye list with singles.
** Extra first bye considerations need to happen for "Pooled Continuous RR with Crossover" 


# Useful Commands:
npx vitest run roundrobin.test.ts
# Run local webserver
npx -y vite@latest
http://localhost:5173?test=true 

####
   🚀 How to Run Tests
   Run King of Court Tests:
     npx vitest run src/kingofcourt.test.ts
	 npx vitest run src/test-14-players.test.ts
	 
	 npx vitest run src/tests/waitlist-court-bug.test.ts
   Run Round Robin Tests:
     npx vitest run src/roundrobin.test.ts
   Run All Unit Tests:
     npm test              # Watch mode
     npm run test:run      # Run once
   Run All E2E Tests:
     npm run test:e2e
   Run Everything:
     npm run test:all
####

# Testing UI, according to Copilot:
     # Install dependencies
     npm install

     # Install Playwright browsers
     npx playwright install

     # Run with interactive UI (recommended)
     npm run test:e2e:ui

     # Or run all tests
     npm run test:e2e

     # View results
     npx playwright show-report
	 
Storage:
     - Windows: C:\Users\<username>\.pickleball\
     - macOS: /Users/<username>/.pickleball/
     - Linux: /home/<username>/.pickleball/

# TODO 

*Make sure first 2 provisional matches are ACTUALLY RANDOM -- not just using the list!
*Add Rounds Mode
*Fix bug where going from 15 to 16 people never utilizes the 4th court!
*With no waitlisted players (or 1 waitlisted player), we need to be more lax about making courts (like it is now). --- TBD 
*Add a clickable button with instructions (so I can just read them, instead of remembering!)
*Add NxM grid support for setup
*Add ability to disable broken courts 
*Add Team Competetive Variety Mode
*Add Team Support for people that want to play together for Regular Competetive Variety (BE CAREFUL NOT TO BREAK THE ALGO!!!)
*Add singles support

